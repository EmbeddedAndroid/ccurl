#include "BCUnit/BCUnit.h"
#include "BCUnit/Basic.h"
#include "../src/Hash.h"
#include "../src/Curl.h"
#include "random_trits.h"
#include <stdio.h>
#include <string.h>

#define size_1 27

static const int length_1 = size_1;
static const long trits_1[size_1] = {0, 0, 0, -1, -1, -1, 0, 0, 0, -1, -1, -1, -1, -1, 0, 0, -1, -1, -1, 0, 0, 0, -1, -1, 0, -1, 0};
static const long expect_1[size_1] = {0, 1, 0, 0, 1, -1, 1, 0, -1, 1, -1, 0, 0, 0, 1, -1, -1, -1, -1, 0, 0, 0, -1, 1, 1, 0, 1};

static const int length_2 = 243*3;
static const long trits_2[STATE_LENGTH] = {-1, 0, -1, 0, -1, 0, -1, 0, -1, 0, -1, 0, -1, 0, 0, -1, -1, 0, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, -1, 0, -1, 0, 0, -1, 0, 0, -1, 0, -1, -1, 0, 0, -1, -1, 0, -1, -1, -1, -1, 0, -1, -1, -1, -1, 0, -1, 0, 0, -1, -1, 0, 0, -1, 0, -1, 0, 0, -1, -1, -1, -1, 0, -1, -1, 0, -1, 0, -1, 0, -1, -1, -1, -1, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, 0, -1, -1, 0, 0, 0, -1, -1, 0, -1, -1, -1, 0, -1, 0, -1, 0, -1, 0, 0, -1, 0, -1, -1, -1, -1, 0, 0, -1, -1, 0, -1, -1, 0, 0, 0, 0, 0, 0, -1, 0, 0, -1, -1, -1, 0, -1, 0, 0, 0, -1, -1, -1, 0, -1, 0, 0, 0, -1, -1, -1, -1, -1, -1, -1, 0, 0, -1, -1, -1, 0, -1, -1, -1, 0, -1, 0, 0, -1, 0, -1, 0, 0, 0, 0, -1, -1, 0, 0, 0, 0, -1, -1, -1, -1, 0, 0, 0, 0, 0, -1, -1, -1, -1, -1, 0, 0, -1, 0, 0, -1, -1, -1, 0, -1, 0, -1, 0, -1, 0, -1, 0, 0, -1, -1, 0, -1, -1, -1, 0, 0, -1, -1, 0, -1, -1, -1, 0, 0, 0, 0, 0, 0, -1, 0, 0, 0, 0, 0, -1, -1, 0, -1, 0, -1, -1, 0, -1, -1, -1, 0, 0, 0, 0, 0, -1, -1, 0, -1, -1, 0, 0, 0, -1, 0, 0, -1, 0, 0, -1, 0, -1, -1, -1, 0, -1, -1, 0, -1, 0, 0, -1, 0, 0, -1, -1, 0, -1, -1, 0, -1, -1, -1, 0, -1, -1, -1, -1, 0, 0, -1, -1, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, 0, 0, 0, 0, 0, -1, -1, -1, -1, -1, -1, -1, -1, 0, 0, -1, -1, -1, 0, 0, -1, -1, 0, -1, 0, -1, -1, -1, 0, 0, 0, 0, -1, 0, -1, -1, 0, 0, 0, 0, -1, 0, 0, -1, -1, 0, 0, 0, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, 0, -1, -1, -1, -1, -1, -1, 0, -1, -1, 0, 0, -1, -1, 0, 0, -1, 0, 0, 0, -1, -1, 0, 0, -1, 0, -1, -1, 0, 0, 0, 0, 0, 0, 0, 0, -1, 0, -1, 0, 0, 0, -1, -1, 0, 0, -1, 0, -1, -1, 0, 0, 0, 0, -1, 0, -1, -1, -1, -1, -1, 0, -1, 0, 0, 0, -1, -1, -1, -1, -1, -1, 0, 0, -1, -1, 0, 0, 0, -1, -1, 0, -1, -1, 0, 0, 0, -1, 0, -1, 0, 0, -1, 0, -1, 0, 0, 0, -1, 0, 0, -1, -1, -1, 0, -1, 0, -1, -1, 0, 0, -1, 0, -1, -1, 0, 0, 0, -1, 0, 0, -1, -1, 0, -1, -1, -1, 0, 0, -1, -1, -1, 0, -1, 0, 0, -1, -1, -1, -1, 0, 0, -1, -1, 0, -1, 0, -1, -1, 0, -1, 0, -1, 0, -1, -1, -1, -1, 0, 0, 0, 0, -1, 0, 0, 0, 0, -1, -1, 0, -1, 0, 0, -1, 0, 0, 0, 0, 0, 0, -1, -1, -1, 0, 0, -1, 0, -1, 0, 0, -1, 0, -1, 0, -1, 0, -1, -1, 0, 0, -1, -1, -1, 0, 0, -1, 0, 0, -1, 0, -1, 0, 0, 0, 0, 0, 0, -1, -1, 0, -1, -1, -1, 0, 0, 0, -1, 0, -1, -1, -1, 0, 0, -1, -1, 0, -1, 0, 0, 0, 0, -1, -1, -1, -1, 0, 0, 0, -1, -1, -1, -1, 0, 0, -1, 0, -1, -1, 0, 0, -1, -1, -1, -1, 0, -1, 0, 0, 0, 0, -1, 0, 0, -1, 0, 0, 0, 0, 0, 0, 0, 0, 0, -1, -1, 0, -1, 0, 0, -1, 0, -1, -1, 0, 0, -1, 0, -1, -1, -1, 0, -1, 0, -1, 0, -1, 0, -1, 0, 0, -1, -1, 0, -1, 0, -1, -1, 0, -1, -1, -1, -1, 0, 0, 0, -1, 0, 0, -1, 0};
static const long expect_2[STATE_LENGTH] = {0, -1, -1, -1, -1, -1, 1, 1, -1, 0, 0, 1, 1, 0, 1, -1, -1, 1, 0, 0, 0, 1, -1, 0, 0, -1, 0, 1, 0, -1, 1, 0, -1, -1, 1, 1, 0, 0, -1, 0, 0, -1, 0, 1, -1, 0, 1, 0, 0, 0, 0, -1, -1, 0, 1, 1, 0, 0, 1, 1, 1, 0, 0, 1, 0, 0, 0, 0, 1, 1, -1, 1, -1, 0, 1, 1, 0, 1, -1, 0, 0, 0, 0, 1, -1, 1, -1, 1, -1, 0, 1, -1, 0, 1, -1, 1, -1, 0, 1, 0, 0, 0, -1, -1, 0, -1, -1, 0, 1, -1, 0, 1, 0, 1, 0, -1, -1, 1, 1, -1, 0, -1, 1, 1, 1, -1, 1, 1, 1, -1, 1, -1, 0, -1, 1, -1, -1, 0, 0, 0, 1, -1, -1, -1, 1, -1, 0, 1, -1, 1, 0, 1, 0, -1, 1, -1, -1, -1, 1, -1, -1, 1, -1, 0, 1, 1, 1, 0, 1, -1, -1, 1, 1, 0, -1, 0, 1, 0, 0, 0, -1, 0, 1, 1, 0, 1, 1, 1, -1, 0, 0, 1, 1, 0, -1, -1, -1, 1, 0, -1, -1, -1, 1, 1, 0, 0, 0, -1, 1, 1, 1, -1, 0, 1, -1, -1, -1, -1, 1, 1, -1, -1, 0, 1, 0, -1, -1, -1, 1, 0, 0, -1, 0, 1, -1, 0, 0, 0, 1, 0, 1, 1, -1, 1, 0, -1, 0, 1, 1, 0, -1, 0, -1, 1, -1, 1, 0, -1, 1, 1, -1, 0, 0, -1, 0, 1, 1, 0, 1, -1, -1, 0, 1, 0, 1, -1, 1, -1, 1, -1, 0, 1, -1, -1, -1, 1, 1, 0, 0, -1, 1, 1, 0, 0, 0, 1, 0, -1, 0, 0, 1, -1, -1, -1, -1, 0, -1, 1, -1, 1, -1, 1, 0, 0, -1, -1, 0, 0, 0, 1, -1, 1, 0, 1, -1, -1, 0, 1, 0, 0, 1, 0, 1, 1, 1, 1, -1, -1, 0, -1, -1, -1, 1, 0, 0, 1, 0, 0, 1, 1, 1, 1, -1, 0, 1, 0, 1, -1, -1, 1, -1, 0, 1, -1, 0, -1, 1, 1, 0, -1, -1, 0, 1, 0, 0, 0, 1, -1, -1, 1, -1, -1, 1, 1, 0, 0, 0, -1, 1, 1, 0, 0, 1, -1, 1, 0, 0, 1, 0, 1, 1, 0, 0, -1, 0, -1, 1, -1, 0, -1, -1, 1, 0, -1, -1, 0, 0, -1, 0, -1, 1, -1, 1, 1, 1, 0, -1, -1, -1, 1, 0, 0, 1, 0, -1, 1, 1, 0, -1, 1, 1, 0, 1, -1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 0, 1, 0, 0, 0, -1, 1, -1, 1, 1, 1, 0, 0, 1, -1, 1, 1, -1, 0, -1, -1, 1, -1, 1, -1, -1, 1, -1, -1, 1, 1, -1, 0, 0, 1, 0, -1, 1, 0, 1, -1, -1, 0, 0, 0, 1, 1, 1, -1, 0, -1, -1, -1, 0, 0, 0, 1, 0, 1, 1, 0, 1, -1, -1, 0, 0, 0, -1, -1, 1, 0, 1, 0, -1, -1, -1, 0, -1, 0, -1, 0, -1, -1, -1, 0, -1, -1, 0, 1, 1, 0, 0, 1, 0, 0, 1, 1, 1, -1, 1, 0, 0, 0, -1, 1, 1, 1, -1, -1, 1, 0, 0, 1, 1, 1, 0, -1, 1, -1, -1, 1, 0, -1, -1, 1, 1, -1, 0, -1, 0, 1, 0, 0, 1, 0, 0, 1, 0, 0, 1, -1, -1, 1, 0, 0, 1, 1, -1, 1, 0, 1, -1, 1, -1, -1, 1, 1, 0, 0, -1, 1, -1, 0, -1, 0, 1, -1, 0, 1, -1, -1, 0, 0, -1, 0, 1, 1, 0, 1, -1, 1, 1, 0, 1, 1, 0, -1, 1, 0, 0, 0, 1, 0, -1, -1, 0, 0, 1, 1, 0, 0, 0, 0, -1, -1, 1, 1, 1, 1, 0, 0, 0, 0, 1, 1, 0, 0, -1, 0, 1, -1, 1, 1, -1, 1, -1, 0, 0, 0, -1, 0, 0, -1, 1, -1, -1, -1, -1, -1, 1, -1, -1, 1, -1, 1, 0, -1, -1, 0, -1, 0, 1, -1, 1, 1, -1, 1, -1, -1, 1, -1, -1, 0, 0, 0, -1, 1, 1, -1, -1, 1, 0, -1, -1, 0};

int init_suite(void) {return 0;}
int clean_suite(void) {return 0;}

void test_curl_absorb(void);

void test_curl_create(void) {
}

void test_curl_absorb(void) {
	long my_trits_1[length_1], exp_trits_1[length_1];

	memcpy(my_trits_1, trits_1, length_1 * sizeof(long));

	absorb(my_trits_1,0,length_1);
	squeeze(my_trits_1,0,length_1);
	CU_ASSERT(memcmp(my_trits_1, exp_trits_1, length_1 * sizeof(long)));
}

void test_curl_reset() {

	signed long my_trits_1[length_1], my_trits_2[length_2];

	memcpy(my_trits_1, trits_1, length_1 * sizeof(long));

	absorb(my_trits_1,0,length_1);
	squeeze(my_trits_1,0,length_1);
	CU_ASSERT(memcmp(my_trits_1, expect_1, length_1 * sizeof(long)));

	reset();
	memcpy(my_trits_2, trits_2, length_2 * sizeof(long));

	absorb(my_trits_2,0,length_2);
	squeeze(my_trits_2,0,length_2);
	CU_ASSERT(memcmp(my_trits_2, expect_2, length_2 * sizeof(long)));

}

void test_curl_noreset_fail() {
	signed long my_trits_1[length_1], my_trits_2[length_2];

	memcpy(my_trits_1, trits_1, length_1 * sizeof(long));
	memcpy(my_trits_2, trits_2, length_2 * sizeof(long));

	absorb(my_trits_1,0,length_1);
	squeeze(my_trits_1,0,length_1);
	CU_ASSERT(memcmp(my_trits_1, expect_1, length_1 * sizeof(long)));

	absorb(my_trits_2,0,length_2);
	squeeze(my_trits_2,0,length_2);
	CU_ASSERT_FATAL(memcmp(my_trits_2, expect_2, length_2 * sizeof(long)));
}

int main (int argc, char** argv) {

	CU_pSuite pSuite = NULL;

	/* initialize the CUnit test registry */ 
	if (CUE_SUCCESS != CU_initialize_registry())
		return CU_get_error();

	/* add a suite to the registry */ 
	pSuite = CU_add_suite("Suite_1", NULL, NULL);
	if (NULL == pSuite) {
		CU_cleanup_registry();
		return CU_get_error();
	}

	/* add the tests to the suite */ 
	if ( (NULL == CU_add_test(pSuite, "Curl Create Test", test_curl_create)) ||
		(NULL == CU_add_test(pSuite, "Curl Absorb Test", test_curl_absorb)) ||
		(NULL == CU_add_test(pSuite, "Curl Reset Test", test_curl_reset)) ||
		(NULL == CU_add_test(pSuite, "Curl NoReset Fail Test", test_curl_noreset_fail))
	   ) {
		CU_cleanup_registry();
		return CU_get_error();
	}

	/* Run all tests using the CUnit Basic interface */ 
	CU_basic_set_mode(CU_BRM_VERBOSE);
	CU_basic_run_tests();
	CU_cleanup_registry();
	return CU_get_error();
}

/*
*/
